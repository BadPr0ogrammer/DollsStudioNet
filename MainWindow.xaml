<Window x:Class="DollsStudioNet.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:hx="http://helix-toolkit.org/wpf/SharpDX"
        xmlns:local="clr-namespace:DollsStudioNet"
        mc:Ignorable="d"
        Title="Dolls Studio Net"
        Width="1000"
        Height="800">
    <Grid>
        <Grid.Resources>
            <BooleanToVisibilityConverter x:Key="boolToVisibilityConverter" />
        </Grid.Resources>
        <Grid.RowDefinitions>
            <RowDefinition Height="20" />
            <RowDefinition Height="32" />
            <RowDefinition Height="32" />
            <RowDefinition Height="*" />
            <RowDefinition Height="6" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        <hx:Viewport3DX x:Name="view"
                        Grid.Row="3"
                        BackgroundColor="#595959"
                        Camera="{Binding Camera}"
                        EffectsManager="{Binding EffectsManager}"
                        EnableSwapChainRendering="True"
                        FXAALevel="Medium"
                        FixedRotationPoint="{Binding ModelCentroid}"
                        FixedRotationPointEnabled="True"                        
                        ShowFrameRate="True">
            <hx:Viewport3DX.InputBindings>
                <KeyBinding Key="B"
                            Command="hx:ViewportCommands.BackView" />
                <KeyBinding Key="F"
                            Command="hx:ViewportCommands.FrontView" />
                <KeyBinding Key="U"
                            Command="hx:ViewportCommands.TopView" />
                <KeyBinding Key="D"
                            Command="hx:ViewportCommands.BottomView" />
                <KeyBinding Key="L"
                            Command="hx:ViewportCommands.LeftView" />
                <KeyBinding Key="R"
                            Command="hx:ViewportCommands.RightView" />
                <KeyBinding Command="hx:ViewportCommands.ZoomExtents"
                            Gesture="Control+E" />
                <MouseBinding Command="hx:ViewportCommands.Rotate"
                              Gesture="RightClick" />
                <MouseBinding Command="hx:ViewportCommands.Zoom"
                              Gesture="MiddleClick" />
                <MouseBinding Command="hx:ViewportCommands.Pan"
                              Gesture="LeftClick" />
            </hx:Viewport3DX.InputBindings>
            <hx:AmbientLight3D Color="#363636" />
            <hx:DirectionalLight3D Direction="{Binding Camera.LookDirection}"
                                   Color="#D6D6D6" />
            <hx:EnvironmentMap3D IsRendering="{Binding RenderEnvironmentMap}"
                                 Texture="{Binding EnvironmentMap}" />
            <hx:Element3DPresenter Content="{Binding GroupModel}" />
            <hx:PostEffectMeshBorderHighlight EffectName="highlight" />
        </hx:Viewport3DX>
        <Menu Grid.ColumnSpan="2"
              Height="20"
              VerticalAlignment="Top">
            <MenuItem Header="File">
                <MenuItem Command="{Binding OpenFileCommand}" Header="Open File" />
                <MenuItem Command="{Binding ExportCommand}" Header="Export" />
            </MenuItem>
            <MenuItem Header="Edit">
                <MenuItem Command="{Binding CopyAsBitmapCommand}" Header="Copy As Bitmap (Window Size)" />
                <MenuItem Command="{Binding CopyAsHiresBitmapCommand}" Header="Copy as Hiresolution Bitmap (1920x1080)" />
            </MenuItem>
        </Menu>
        <DockPanel Grid.ColumnSpan="2" Grid.Row="1" VerticalAlignment="Top">
            <ToolBar>
                <Button ToolTip="Open" Command="{Binding OpenFileCommand}">
                    <Image Source="pack://application:,,,/icons/open2.png" />
                </Button>
                <Button ToolTip="Play animation" Command="{Binding PlayCommand}">
                    <Image Source="pack://application:,,,/icons/play1.png" />
                </Button>
                <ComboBox Width="100" DisplayMemberPath="Name"
                    IsEnabled="{Binding ElementName=aniCheckbox, Path=IsChecked}"
                    ItemsSource="{Binding Animations}"
                    SelectedItem="{Binding SelectedAnimation}" />
                <Label Content="Speed:"  />
                <TextBlock VerticalAlignment="Center" Text="{Binding Speed, 
                    StringFormat={}{0:F2}}" FontFamily="Monospace"/>
                <Slider VerticalAlignment="Bottom" Width="100" 
                    Maximum="10"
                    Minimum="0.05"
                    SmallChange="0.1"
                    Value="{Binding Speed}" />
                <Label>
                    <TextBlock FontFamily="Monospace">
                    <Run>Time:</Run>
                    <Run Text="{Binding CurrAnimationTime, StringFormat={}{0:F2}}" />
                    </TextBlock>
                </Label>
            </ToolBar>
            <ToolBar>
                <ToggleButton IsChecked="{Binding ShowWireframe}" ToolTip="Surface/Wireframe">
                    <Image Source="pack://application:,,,/icons/wireframe.png" />
                </ToggleButton>
                <ToggleButton IsChecked="{Binding RenderFlat}" ToolTip="Flat Shading">
                    <Image Source="pack://application:,,,/icons/flat.png" />
                </ToggleButton>
                <ToggleButton IsChecked="{Binding ElementName=view, Path=EnableSSAO}" ToolTip="Enable SSAO">
                    <Image Source="pack://application:,,,/icons/ssao.png" />
                </ToggleButton>
                <ToggleButton IsChecked="{Binding RenderEnvironmentMap}" ToolTip="Render EnvironmentMap">
                    <Image Source="pack://application:,,,/icons/envmap.png" />
                </ToggleButton>
            </ToolBar>
            <ToolBar>
                <Button Command="{Binding ResetCameraCommand}" ToolTip="Reset Camera">
                    <Image Source="pack://application:,,,/icons/view_all1.png" />
                </Button>
                <Button ToolTip="Front View" Command="hx:ViewportCommands.FrontView">
                    <Image Source="pack://application:,,,/icons/y_up_x_right.png" />
                </Button>
                <Button ToolTip="Top View" Command="hx:ViewportCommands.TopView">
                    <Image Source="pack://application:,,,/icons/z_up_x_left.png" />
                </Button>
                <Button ToolTip="Back View" Command="hx:ViewportCommands.BackView">
                    <Image Source="pack://application:,,,/icons/y_up_x_left.png" />
                </Button>
                <ToggleButton IsChecked="{Binding ShowSkeleton}"  ToolTip="Show Skeleton">
                    Skeleton
                </ToggleButton>
            </ToolBar>
            <ToolBar>
                <Button ToolTip="Settings">
                    <Image Source="pack://application:,,,/icons/settings2.png" />
                </Button>
                <Button ToolTip="About and Bug report email." Command="{Binding AboutCommand}">
                    <Image Source="pack://application:,,,/icons/info.png" />
                </Button>
                <Button ToolTip="Close Scene" Command="{Binding CloseSceneCommand}">
                    <Image Source="pack://application:,,,/icons/cancel1.png" />
                </Button>
            </ToolBar>
        </DockPanel>
        <Slider Grid.Row="2"
                Height="32"
                VerticalAlignment="Top"
                LargeChange="1"
                Maximum="{Binding EndTime}"
                Minimum="{Binding StartTime}"
                SmallChange="0.1"
                Value="{Binding CurrAnimationTime}" />
        <StackPanel Grid.Row="2" Grid.Column="1" Grid.RowSpan="3"
            Width="250"
            Margin="10,24,4,4"
            Height="Auto"
            VerticalAlignment="Stretch">
            <Expander>
                <Expander.Header>"Scene Graph"</Expander.Header>
                <ScrollViewer>
                    <TreeView ItemsSource="{Binding GroupModel.GroupNode.Items}">
                        <TreeView.ItemContainerStyle>
                            <Style TargetType="TreeViewItem">
                                <Setter Property="IsSelected"
                                Value="{Binding Tag.Selected, Mode=TwoWay}" />
                                <Setter Property="IsExpanded"
                                Value="{Binding Tag.Expanded, Mode=TwoWay}" />
                            </Style>
                        </TreeView.ItemContainerStyle>
                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate ItemsSource="{Binding Items}">
                                <TextBlock Text="{Binding Name}">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Setters>
                                                <Setter Property="Foreground"
                                                Value="Black" />
                                            </Style.Setters>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsAnimationNode}"
                                                     Value="true">
                                                    <Setter Property="Foreground"
                                                    Value="Blue" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>
                    </TreeView>
                </ScrollViewer>
            </Expander>
            <Expander>
                <Expander.Header>"123"</Expander.Header>
                <ScrollViewer>
                    <StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Expander>
        </StackPanel>
        <Grid Grid.Row="4"
              Background="#7B363636"
              Visibility="{Binding IsLoading, Converter={StaticResource boolToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Orientation="Vertical">
                <TextBlock Foreground="White">Loading Model</TextBlock>
                <ProgressBar Grid.Row="4"
                             Width="200"
                             Height="30"
                             IsIndeterminate="True" />
            </StackPanel>
        </Grid>
    </Grid>
</Window>
